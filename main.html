<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en" xmlns:og="http://ogp.me/ns#" xmlns:fb="https://www.facebook.com/2008/fbml">
  <head>
      <link rel="manifest" href="/manifest.json">
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      <meta name="description" content="" />
      <meta name="Keywords" content="" />
      <meta http-equiv="Content-Language" content="en" />
      <meta http-equiv="EXPIRES" content="" />
      <meta name="expires" content="" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
      <meta name="robots" content="index, follow" />
      <!-- Firefox, Chrome, Safari, IE 11+ and Opera. 196x196 pixels in size. -->
      <link rel="icon" href="">
      <!-- Style stuff -->
      <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
      <link rel="stylesheet" href="dist/css/main.min.css" />
      <!-- Fullcallendar -->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.css" />
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.print.css" media='print' />
      <link rel='stylesheet' href='fullcalendar/fullcalendar.css' media='print' />
      <script type="text/javascript" src="http://www.datejs.com/build/date.js"></script>
      <script type='text/javascript' src='../../fullcalendar/gcal.js'></script>
      <script type='text/javascript' src='../../fullcalendar/fullcalendar.js'></script>
      <!--Firebase stuff-->
      <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase-app.js"></script>
      <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase-auth.js"></script>
      <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase-database.js"></script>
      <!--- call the firebase.js that contain the javascript code -->
      <script type="text/javascript" src="dist/scripts/firebase.js"></script>

      <!--Sources for timepicker -->
      <link href="http://www.jqueryscript.net/css/jquerysctipttop.css" rel="stylesheet" type="text/css">
      <link href='../../scrtimer/css/timedropper.css' rel="stylesheet" type="text/css" />

      <!-- LEAFLET MAPS
      <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
      integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
      crossorigin=""/>
      <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
      integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
      crossorigin=""></script> -->

      <!-- HERE maps -->
      <script src="http://js.api.here.com/v3/3.0/mapsjs-core.js" 
      type="text/javascript" charset="utf-8"></script>
      <script src="http://js.api.here.com/v3/3.0/mapsjs-service.js" 
      type="text/javascript" charset="utf-8"></script>
      <script src="http://js.api.here.com/v3/3.0/mapsjs-mapevents.js" 
      type="text/javascript" charset="utf-8"></script>
      <script src="http://js.api.here.com/v3/3.0/mapsjs-places.js"
      type="text/javascript" charset="UTF-8"
      ></script>

        <!-- user interface: -->
      <script src="http://js.api.here.com/v3/3.0/mapsjs-ui.js" 
      type="text/javascript" charset="utf-8"></script>
      <link rel="stylesheet" type="text/css" 
      href="http://js.api.here.com/v3/3.0/mapsjs-ui.css" />

      <!-- standard javascript sources -->
      <script type='text/javascript' src='lib/jquery.min.js'></script>
      <script type='text/javascript' src='lib/moment.min.js'></script>
      <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>

    <style>
      p {
      color: black;
      margin: 8px;
      }
      body {
        margin: 0px 10px;
        padding: 0;
        font-family: "Lucida Grande",Helvetica,Arial,Verdana,sans-serif;
        font-size: 14px;
      }
      #calendar {
        max-width: 900px;
        margin: 0 auto;
      }

      #eventHeader {
        margin-right: 140px;
      }
    </style>

   <title> Home </title>
  </head>
  <body>
    <!-- Welcome to User -->
    <div class="jumbotron jumbotron-fluid">
      <div class="container">
        <h1 class="display-4">SmartCommute: Home</h1>
        <!-- <p class="lead">Please, choose something to do:</p> -->
      </div>
    </div>
    <p class="lead">Welcome USER, how's your day? Choose something to do:</p>

    <!-- Bottons to access other GUI's-->
    <div class="btn-group" role="group" aria-label="Basic example">
      <!-- <a href="src/html/appointment3.html" type="button" class="btn btn-secondary">Appointments</a> -->
      <a href="src/html/roadmap.html" type="button" class="btn btn-secondary">Roadmap</a>
      <a href="src/html/settings.html" type="button" class="btn btn-secondary">Settings</a>
    </div>

    <!-- to Logout -->
    <button type="button" class="btn btn-danger" onclick="mainApp.logOut()">Logout</button>

    <!-- Insert the calendar -->
    <div id='calendar'></div>

    <!--Include dialog using modal fade to newEvent event-->
    <div class="modal fade" id="newEvent" role="dialog" aria-labelledby="eventFormLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <!--Title of modal windows -->
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
              <h4 class="modal-title" id="eventHeader">New Apppointment</h4>
            </div>
            
            <!--NEW EVENT MODAL -->
            <div class="modal-body">
              <b id="selected"></b>
              <form>
                <!--Title event field -->
                <div class="form-group">
                  <label for="title" class="form-control-label">Title</label>
                  <input type="text" class="form-control" id="title">
                </div>
                <!-- searchbox -->
                <div class="row">
                  <!-- Search Box location-->
                  <div class="col">
                    <label for="locationField" class="form-control-label">Location</label>
                    <div id="locationField" class="ui-widget">
                      <label for="awesomplete1"></label>
                      <input id="newEventLocation" placeholder="Enter your initial address" type="text" class="awesomplete"
                      onkeyup="return autoCompleteListener(this, event);"/>
                    </div>
                  </div>
                </div>
                <!--Start and End time.-->
                <div class="row">
                  <!-- Box Start time-->
                  <div class="col">
                    <label for="stime">Start time</label>
                    <input type="text" id="stime" >
                  </div>
                  <!-- Box End time-->
                  <div class="col">
                    <label for="etime">End time</label>
                    <input type="text" id="etime" >
                  </div>
                </div>
                <!--Description field-->
                <div class="form-group">
                  <label for="info_description">Description</label>
                  <textarea class="form-control" id="info_description" rows="3"></textarea>
                </div>
              </form>
            </div>
            <!-- Footer that contains the botton to create or cancel -->
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
              <button type="button" class="btn btn-success" id="submit">Create Event</button>
            </div>
          </div>
        </div>
    </div>

    <!--EDIT EVENT MODAL-->
    <div class="modal fade" id="editEvent" role="dialog" aria-labelledby="eventFormLabel" aria-hidden="true" data-persist="false">
      <div class="modal-dialog" role="document">
        <!--Title of modal windows -->
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <h4 class="modal-title" id="eventHeader">Update Apppointment</h4>
          </div>
          <!--Dialog that contain the fields to edit an event -->
          <div class="modal-body">
            <b id="editSelected"></b>
            <form>
            <!--Title event field -->
              <div class="form-group">
                <label for="title" class="form-control-label">Title</label>
                <input type="text" class="form-control" id="editTitle">
              </div>
              <!--Searching Box -->
              <div class="row">
                <!-- Search Box location-->
                <div class="col">
                  <label for="editlocationField" class="form-control-label">Location</label>
                  <div id="editocationField" class="ui-widget">
                    <label for="awesomplete2">insert trial</label>
                    <input id="editEventLocation" placeholder="Enter your initial address" type="text" class="awesomplete"
                    onkeyup="return autoCompleteListener(this, event);" />
                  </div>
                </div>
              </div>
              <!--Start and End time.-->
              <div class="row">
                <!-- Box Start time-->
                <div class="col">
                  <label for="editstime">Start time</label>
                  <input type="text" id="editstime" >
                </div>
                <!-- Box End time-->
                <div class="col">
                  <label for="editetime">End time</label>
                  <input type="text" id="editetime" >
                </div>
              </div>
              <!--.Description field-->
              <div class="form-group">
                <label for="editinfo_description">Description</label>
                <textarea class="form-control" id="editinfo_description" rows="3"></textarea>
              </div>
            </form>
          </div>

          <div class="modal-footer">
            <button type="button" class="btn btn-danger left" id="delete">Delete Event</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-success" id="update">Update Event</button>
          </div>
        </div>
      </div>
    </div>

    <!--Js of  timepicker -->
    <script src='../../scrtimer/js/timedropper.js'></script>

    <script>
      $( "#stime" ).timeDropper({
        format: 'HH:mm',
        setCurrentTime: true,
        meridians: false});
      $( "#etime" ).timeDropper({
        format: 'HH:mm',
        setCurrentTime: true,
        meridians: false});
      $( "#editstime" ).timeDropper({
        format: 'HH:mm',
        setCurrentTime: true,
        meridians: false});
      $( "#editetime" ).timeDropper({
        format: 'HH:mm',
        setCurrentTime: true,
      meridians: false});
    </script>

    <script>
      //communication with the Heremaps platform
      var platform = new H.service.Platform({ //my heremaps platform
      'app_id': 'SKrth5W6mIRCcxVYfDWi',
      'app_code': 'bW5PezhhynKJWF85-sSZlA'
      });
      var pixelRatio = window.devicePixelRatio || 1;
      var defaultLayers = platform.createDefaultLayers({
        tileSize: pixelRatio === 1 ? 256 : 512,
        ppi: pixelRatio === 1 ? undefined : 320
      });

      //autocomplete engine:
      var AUTOCOMPLETION_URL = 'https://autocomplete.geocoder.api.here.com/6.2/suggest.json'
      var ajaxRequest = new XMLHttpRequest();
      var query= '';

      //function triggered on key up of the input fields
      function autoCompleteListener(textBox, event) {
        if (query != textBox.value){
          if (textBox.value.length >= 1){
            var params = '?' +
              'query=' +  encodeURIComponent(textBox.value) +   // The search text which is the basis of the query
              '&beginHighlight=' + encodeURIComponent('<mark>') + //  Mark the beginning of the match in a token. 
              '&endHighlight=' + encodeURIComponent('</mark>') + //  Mark the end of the match in a token. 
              '&maxresults=5' +  // The upper limit the for number of suggestions to be included 
                                // in the response.  Default is set to 5.
              '&app_id=SKrth5W6mIRCcxVYfDWi' +
              '&app_code=bW5PezhhynKJWF85-sSZlA';
            ajaxRequest.open('GET', AUTOCOMPLETION_URL + params );
            ajaxRequest.send();
            console.log('called service');
          }
        }
        query = textBox.value;

      }

      function onAutoCompleteSuccess() {
       addSuggestionsToPanel(this.response);  // In this context, 'this' means the XMLHttpRequest itself.
      }
      function onAutoCompleteFailed() {
        console.log('called fail');
        alert('autocomplete service not available');
      }
      // Attach the event listeners to the XMLHttpRequest object
      ajaxRequest.addEventListener("load", onAutoCompleteSuccess);
      ajaxRequest.addEventListener("error", onAutoCompleteFailed);
      ajaxRequest.responseType = "json";

      //declare vars for autocomplete:
      var inputFields = document.getElementsByClassName("awesomplete");

      function addSuggestionsToPanel(response){
        var suggestionsList = [];
        console.log('addSuggestionsToPanel / enter with:');
        console.log(response);
        for (var i in response.suggestions){
          var sStreet = response.suggestions[i].address.street;
          var sStreetF = removeHtmls(sStreet);
          var sCity = response.suggestions[i].address.city;
          var sCityF = removeHtmls(sCity);
          var sState = response.suggestions[i].address.state;
          var sStateF = removeHtmls(sState);
          var sZip = response.suggestions[i].address.postalCode;
          var sZipF = removeHtmls(sZip);
          var sCountry = response.suggestions[i].address.country;
          var sCountryF = removeHtmls(sCountry);
          var sSuggestion = sStreetF+sCityF+sStateF+sZipF+sCountryF; //string containing the label of the address
          
          suggestionsList.push(sSuggestion);
        }
        console.log(suggestionsList);
        $(".awesomplete").autocomplete({
            source: suggestionsList
        });
      }
      var removeHtmls = function(sString){
        if (sString != undefined){
          var sString1 = sString.replace('<mark>', '');
          var sString2 = sString1.replace('</mark>', '');
          return sString2 + ' ';
        }else{
          return '';
        }
      }

      // ///////////////////////////////////////////////////////////////////////////
      // function geocode(platform) {
      //   var geocoder = platform.getGeocodingService(),
      //   geocodingParameters = {
      //     searchText: $('.addressFields').val(),
      //     jsonattributes : 1
      //   };
      //   geocoder.geocode(geocodingParameters, onSuccess, onError);
      // }

      // function onSuccess(result) {
      //   var locations = result.response.view[0].result;
      
      //   addLocationsToMap(locations);
      //   addLocationsToPanel(locations);
        
      // }
      // function onError(error) {
      //   alert('Ooops! could not establish connection with the geocoding service');
      // }

    </script>
    
    <!--- main.js initializes the user auth-->
    <script type="text/javascript" src="dist/scripts/main.js"></script>
    <!-- app.js contains the app engine (the code) -->
    <script type="text/javascript" src="dist/scripts/app.js"></script>
    <!--- call the event.js that contains the events saved -->
    <script type="text/javascript" src="dist/scripts/events.js"></script>
    <!-- settings.js initializes the user settings -->
    <script type="text/javascript" src="dist/scripts/settings.js"></script>
    <!-- maps.js contains the searchbox listener for the heremaps complete function -->
    <script type="text/javascript" src="dist/scripts/maps.js"></script>

    <!--EXTERNAL SOURCES-->
    <!--older jquery version for proper funtionalities of timerpicker-->
    <!-- <script src="http://code.jquery.com/jquery-1.12.1.min.js"></script> -->
    
    <!--.......ajax, bootstrap and fullcalendar CDN's.......-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/3.9.0/fullcalendar.min.js"></script>
  </body>
</html>