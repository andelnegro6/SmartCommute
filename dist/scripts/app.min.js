"use strict";$(document).ready(function(){var v;$("#calendar").fullCalendar({header:{left:"today prev,next",center:"title",right:"timelineDay,timelineThreeDays,agendaWeek,month,listWeek"},eventOverlap:!1,slotEventOverlap:!1,allDay:!0,selectable:!0,selectHelper:!0,defaultView:"month",navLinks:!0,editable:!0,eventLimit:!0,timezone:"America/Chicago",select:function(e,t){var i=e.format(),n=t.format(),a=new Date(t).getUTCDate()-1,r="";r=a.toString().length<2?"0"+a.toString():a.toString();var s=n.substr(0,8),l="".concat(s+r);d(i,l)},dayClick:function(e){new Date(e);var t=e.format();d(t,t)},eventClick:function(e,t,i){n(e)},eventRender:function(e,t){t.addClass(e.description),t.popover({title:e.title,content:e.description,trigger:"hover",placement:"top",container:"body"})},eventSources:["src/scripts/events.js","src/scripts/settings.js"]});var c=function(e){return e.length<2?"0"+e:e},d=function(c,u){$("#selected").text("selected days: "+c+" to "+u),$("input#title").val(""),$("textarea#info_description").val(""),$("#newEvent").modal("show"),$("#submit").unbind(),$("#submit").on("click",function(){var e,t=$("input#title").val(),i=$("input#stime").val(),n=$("input#etime").val(),a=$("textarea#info_description").val(),r=firebase.auth().currentUser;null!=r&&(r.displayName,r.email,r.emailVerified,e=r.uid);var s=c+" "+i+" Z",l=u+" "+n+" Z",d=validateEvents(e,Date.parse(s),Date.parse(l));if(t&&d){var o={title:t,start:c+"T"+i+":00.000Z",end:u+"T"+n+":00.000Z",description:a};!function(e,t,i,n,a){var r={title:t,start:n,end:a,description:i};v=firebase.database().ref().child("events").push().key;var s={};s["/users/"+e+"/events/"+(r.id=v)]=r,firebase.database().ref().update(s)}(e,o.title,o.description,o.start,o.end),o.id=v,console.log(o),$("#calendar").fullCalendar("renderEvent",o,!0),eventRenderer(),$("#newEvent").modal("hide")}else alert("Title is blank or date is incorrect. Try again.")})},n=function(m,e,t){console.log(m.start,m.end),$("#editSelected").text("Selected days: "+m.start.format().split("T",1)+" to "+m.end.format().split("T",1)),$("input#editTitle").val(m.title),$("textarea#editinfo_description").val(m.description);var i=(m.start._d.getHours()-1).toString(),n=m.start._d.getMinutes().toString(),a=(m.end._d.getHours()-1).toString(),r=m.end._d.getMinutes().toString(),s=c(i),l=c(n),d=c(a),o=c(r);$("input#editstime").val(s+":"+l),$("input#editetime").val(d+":"+o),$("#editEvent").modal("show"),$("#update").unbind(),$("#update").on("click",function(){var e,t=$("input#editTitle").val(),i=$("input#editstime").val(),n=$("input#editetime").val(),a=$("textarea#editinfo_description").val(),r=firebase.auth().currentUser;null!=r&&(r.displayName,r.email,r.emailVerified,e=r.uid);var s=m.start.format().split("T",1),l=m.end.format().split("T",1),d=s[0],o=l[0],c=d+" "+i+" Z",u=o+" "+n+" Z",v=Date.parse(c),f=Date.parse(u);if(t&&0<f-v){m.description=a,m.title=t,m.start=d+"T"+i+":00.000Z",m.end=o+"T"+n+":00.000Z";var p={title:t,start:d+"T"+i+":00.000Z",end:o+"T"+n+":00.000Z",description:a,id:m.id};$("#calendar").fullCalendar("updateEvent",m),eventRenderer(),$("#editEvent").modal("hide"),firebase.database().ref("users/"+e+"/events/"+m.id).set({title:p.title,description:p.description,start:p.start,end:p.end,id:p.id})}else alert("Title is blank or date is incorrect. Try again.")}),$("#delete").on("click",function(){var e,t=firebase.auth().currentUser;null!=t&&(e=t.uid),firebase.database().ref("users/"+e+"/events/"+m.id).set(null),$("#delete").unbind(),eventRenderer(),$("#editEvent").modal("hide")})}});var eventRenderer=function(){$("#calendar").fullCalendar("removeEvents"),events()},getCal1Id=function(e){return"_fc"+(e.replace("_fc","")-1)},disableEnter=function(){$("body").bind("keypress",function(e){if(13==e.keyCode)return e.preventDefault(),!1})};function validateEvents(e,t,i){return!(i-t<0)&&isNotColliding(e,t,i)}function isNotColliding(e,s,l){var d=!0,o=!0;for(firebase.database().ref("users/"+e+"/events/").once("value",function(e){var t=e.toJSON();for(var i in t){var n=t[i],a=Date.parse(n.start),r=Date.parse(n.end);a<l&&s<r&&(o=!1)}d=!1},errData);d;);return o}function errData(e){console.log("ERROR!"+e)}