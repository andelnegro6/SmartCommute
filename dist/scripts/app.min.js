"use strict";$(document).ready(function(){var f,p="",m="";$("#calendar").fullCalendar({header:{left:"today prev,next",center:"title",right:"timelineDay,timelineThreeDays,agendaWeek,month,listWeek"},slotEventOverlap:!1,allDay:!0,selectable:!0,selectHelper:!0,defaultView:"listWeek",navLinks:!0,editable:!1,eventLimit:!0,timezone:"America/Chicago",select:function(e,t){p=e.format(),m=t.format(),i(e)},eventClick:function(e,t,i){n(e),console.log(e.id)},eventRender:function(e,t){t.addClass(e.description),t.popover({title:e.title,content:e.description,trigger:"hover",placement:"top",container:"body"})},eventSources:["src/scripts/events.js","src/scripts/settings.js"]});var i=function(e){$("input#title").val(""),$("textarea#info_description").val(""),$("#newEvent").modal("show"),$("#submit").unbind(),$("#submit").on("click",function(){var e,t=$("input#title").val(),i=$("input#stime").val(),n=$("input#etime").val(),a=$("textarea#info_description").val(),r=firebase.auth().currentUser;null!=r&&(r.displayName,r.email,r.emailVerified,e=r.uid);var l=new Date(m),d=l.getUTCFullYear(),s=l.getUTCMonth()+1,o=l.getUTCDate(),c="",u="";u=s.toString().length<2?"0"+s.toString():s.toString(),c=o.toString().length<2?"0"+o.toString():o.toString();var v=d.toString()+"-"+u+"-"+c;if(t){var g={title:t,start:p+"T"+i+":00.000Z",end:v+"T"+n+":00.000Z",description:a};!function(e,t,i,n,a){var r={title:t,start:n,end:a,description:i};f=firebase.database().ref().child("events").push().key;var l={};l["/users/"+e+"/events/"+(r.id=f)]=r,firebase.database().ref().update(l)}(e,g.title,g.description,g.start,g.end),g.id=f,console.log(g),$("#calendar").fullCalendar("renderEvent",g,!0),$("#newEvent").modal("hide")}else alert("Title can't be blank. Please try again.")})},n=function(p){$("input#editTitle").val(p.title),$("textarea#editinfo_description").val(p.description);var e=(p.start._d.getHours()-1).toString(),t=p.start._d.getMinutes().toString(),i=(p.end._d.getHours()-1).toString(),n=p.end._d.getMinutes().toString();$("input#editstime").val(e+":"+t),$("input#editetime").val(i+":"+n),$("#editEvent").modal("show"),$("#update").unbind(),$("#update").on("click",function(){var e,t=$("input#editTitle").val(),i=$("input#editstime").val(),n=$("input#editetime").val(),a=$("textarea#editinfo_description").val(),r=firebase.auth().currentUser;null!=r&&(r.displayName,r.email,r.emailVerified,e=r.uid);var l=p.start._d.getUTCFullYear().toString(),d=(p.start._d.getUTCMonth()+1).toString(),s=p.start._d.getUTCDate().toString(),o=p.end._d.getUTCFullYear().toString(),c=(p.end._d.getUTCMonth()+1).toString(),u=(p.end._d.getUTCDate()-1).toString();s=s.length<2?"0"+s:s,d=d.length<2?"0"+d:d,u=u.length<2?"0"+u:u;var v=l+"-"+d+"-"+s,g=o+"-"+(c=c.length<2?"0"+c:c)+"-"+u;if(console.log(v,g),t){p.description=a,p.title=t,p.start=v+"T"+i+":00.000Z",p.end=g+"T"+n+":00.000Z";var f={title:t,start:v+"T"+i+":00.000Z",end:g+"T"+n+":00.000Z",description:a,id:p.id};$("#calendar").fullCalendar("updateEvent",p),$("#editEvent").modal("hide"),firebase.database().ref("users/"+e+"/events/"+p.id).set({title:f.title,description:f.description,start:f.start,end:f.end,id:f.id})}else alert("Title can't be blank. Please try again.")}),$("#delete").on("click",function(){var e,t=firebase.auth().currentUser;null!=t&&(e=t.uid),firebase.database().ref("users/"+e+"/events/"+p.id).set(null),$("#delete").unbind(),p._id.includes("_fc")&&$("#calendar").fullCalendar("removeEvents",[getCal1Id(p._id)]),$("#calendar").fullCalendar("removeEvents",[p._id]),$("#editEvent").modal("hide")})}});var getCal1Id=function(e){return"_fc"+(e.replace("_fc","")-1)},disableEnter=function(){$("body").bind("keypress",function(e){if(13==e.keyCode)return e.preventDefault(),!1})};