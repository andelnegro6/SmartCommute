"use strict";var newEventKey;$(document).ready(function(){$("#calendar").fullCalendar({header:{left:"today prev,next",center:"title",right:"timelineDay,timelineThreeDays,agendaWeek,month,listWeek"},eventOverlap:!1,slotEventOverlap:!1,allDay:!0,selectable:!0,selectHelper:!0,defaultView:"month",navLinks:!0,editable:!0,eventLimit:!0,timezone:"America/Chicago",select:function(e,t){var n=e.format(),i=t.format(),a=new Date(t).getUTCDate()-1,r="";r=a.toString().length<2?"0"+a.toString():a.toString();var l=i.substr(0,8),s="".concat(l+r);d(n,s)},dayClick:function(e){new Date(e);var t=e.format();d(t,t)},eventClick:function(e,t,n){i(e)},eventRender:function(e,t){var n=e.start.format().slice(11,16),i=e.end.format().slice(11,16);t.addClass(e.description),t.popover({title:e.title,content:"start time: "+n+", end time: "+i,trigger:"hover",placement:"top",container:"body"})},eventSources:["src/scripts/events.js","src/scripts/settings.js"]});var c=function(e){return e.length<2?"0"+e:e},d=function(v,u){$("#selected").text("selected days: "+v+" to "+u),$("input#title").val(""),$("textarea#info_description").val(""),$("#newEvent").modal("show"),$("#submit").unbind(),$("#submit").on("click",function(){var e,t=$("input#title").val(),n=$("input#stime").val(),i=$("input#etime").val(),a=$("textarea#info_description").val(),r=$("input#newEventLocation").val(),l=firebase.auth().currentUser;null!=l&&(l.displayName,l.email,l.emailVerified,e=l.uid);var s=v+"T"+n+":00",d=u+"T"+i+":00",o=Date.parse(s),c=Date.parse(d);t?validateEvents(e,o,c,{title:t,start:v+"T"+n+":00.000Z",end:u+"T"+i+":00.000Z",description:a,location:r}):alert("please insert a title")})},i=function(m,e,t){console.log(m.start,m.end),$("#editSelected").text("Selected days: "+m.start.format().split("T",1)+" to "+m.end.format().split("T",1)),$("input#editTitle").val(m.title),$("textarea#editinfo_description").val(m.description),$("input#editEventLocation").val(m.location);var n=(m.start._d.getHours()-1).toString(),i=m.start._d.getMinutes().toString(),a=(m.end._d.getHours()-1).toString(),r=m.end._d.getMinutes().toString(),l=c(n),s=c(i),d=c(a),o=c(r);$("input#editstime").val(l+":"+s),$("input#editetime").val(d+":"+o),$("#editEvent").modal("show"),$("#update").unbind(),$("#update").on("click",function(){var e,t=$("input#editTitle").val(),n=$("input#editstime").val(),i=$("input#editetime").val(),a=$("textarea#editinfo_description").val(),r=$("input#editEventLocation").val(),l=firebase.auth().currentUser;null!=l&&(l.displayName,l.email,l.emailVerified,e=l.uid);var s=m.start.format().split("T",1),d=m.end.format().split("T",1),o=s[0],c=d[0],v=o+" "+n+" Z",u=c+" "+i+" Z",p=Date.parse(v),f=Date.parse(u);t?(m.description=a,m.title=t,m.start=o+"T"+n+":00.000Z",m.end=c+"T"+i+":00.000Z",validateEvents(e,p,f,{title:t,start:o+"T"+n+":00.000Z",end:c+"T"+i+":00.000Z",description:a,location:m.location=r,id:m.id},m)):alert("Title is blank. Try again.")}),$("#delete").on("click",function(){var e,t=firebase.auth().currentUser;null!=t&&(e=t.uid),firebase.database().ref("users/"+e+"/events/"+m.id).set(null),$("#delete").unbind(),eventRenderer(),$("#editEvent").modal("hide")})}});var eventRenderer=function(){$("#calendar").fullCalendar("removeEvents"),events()},getCal1Id=function(e){return"_fc"+(e.replace("_fc","")-1)},disableEnter=function(){$("body").bind("keypress",function(e){if(13==e.keyCode)return e.preventDefault(),!1})};function allEventsOk(e){return 0<e}function validateEvents(e,t,n,i,a){n-t<0&&i.title?alert("event times are invalid. Please correct"):isNotColliding(e,t,n,i,a)}function isNotColliding(s,d,o,c,v){firebase.database().ref("users/"+s+"/events/").once("value").then(function(e){var t=e.toJSON(),n=new Array;for(var i in t){var a=t[i],r=Date.parse(a.start),l=Date.parse(a.end);r<o&&d<l?n.push(0):n.push(1)}null==c.id&&null==c.id||n.pop(),n.every(allEventsOk)?null==c.id||null==c.id?(writeNewEvent(s,c.title,c.start,c.end,c.description,c.location),c.id=newEventKey,$("#calendar").fullCalendar("renderEvent",c,!0),eventRenderer(),$("#newEvent").modal("hide")):(firebase.database().ref("users/"+s+"/events/"+v.id).set({title:c.title,description:c.description,start:c.start,end:c.end,id:c.id}),$("#calendar").fullCalendar("updateEvent",v),eventRenderer(),$("#editEvent").modal("hide")):alert("One or more events overlapping. Try changing the time.")})}function errData(e){console.log("ERROR!"+e)}var writeNewEvent=function(e,t,n,i,a,r){var l={title:t,start:n,end:i,description:a,location:r},s=firebase.database().ref().child("events").push().key,d={};return d["/users/"+e+"/events/"+(l.id=s)]=l,firebase.database().ref().update(d),s};