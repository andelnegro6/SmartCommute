"use strict";$(document).ready(function(){var e,t;e={},(t=app_fireBase).auth().onAuthStateChanged(function(e){e?(e.uid,o(),navigator.geolocation?($("#calendarInRoadmap").fullCalendar("changeView","agendaDay"),navigator.geolocation.getCurrentPosition(n)):alert("geolocation is not supported by this browser.")):window.location.replace("index.html")}),e.logOut=function(){t.auth().signOut()},$("#calendarInRoadmap").fullCalendar({header:{right:"prev,next today"},eventOverlap:!1,selectable:!0,selectHelper:!0,allDaySlot:!1,slotEventOverlap:!1,allDay:!0,editable:!0,eventLimit:!0,timezone:"America/Chicago",eventRender:function(e,t){var o=e.start.format().slice(11,16),n=e.end.format().slice(11,16);t.addClass(e.description),t.popover({title:e.title,content:"start time: "+o+", end time: "+n,trigger:"hover",placement:"top",container:"body"})},eventSources:["../scripts/events.js","../scripts/settings.js"]});var o=function(){var e=new Date,t=e.getFullYear(),o=e.getMonth()+1,n=e.getDate();$("#todaysDate").html("Today is "+n+"/"+o+"/"+t+"!")};var n=function(e){var t=e.coords;!function(r,l){var s=new H.service.Platform({app_id:"SKrth5W6mIRCcxVYfDWi",app_code:"bW5PezhhynKJWF85-sSZlA"});console.log(r,l);var e=s.createDefaultLayers(),t=new H.Map(document.getElementById("mapContainer"),e.normal.map,{zoom:10,center:{lat:r,lng:l}}),o=new H.mapevents.MapEvents(t);t.addEventListener("tap",function(e){console.log(e.type,e.currentPointer.type)});new H.mapevents.Behavior(o),H.ui.UI.createDefault(t,e);var n,a=firebase.auth().currentUser;null!=a&&(n=a.uid);firebase.database().ref("users/"+n+"/events/").once("value").then(function(e){var t=e.toJSON();console.log(t);var o=[],n=moment();for(var i in t)0<moment(t[i].end)-n&&(t[i].start=moment(t[i].start),t[i].end=moment(t[i].end),o.push(t[i]),console.log(t[i]));console.log(o),o.sort(function(e,t){return e.start.diff(t.start)}),console.log(o);var a=s.getGeocodingService();c(a,r,l,o,function(e,t,o){console.log(e,t,o);var n=s.getRoutingService();u(n,t,o,e,function(e,t){console.log(e,t);var o=[],n=route.shape,a=new H.geo.LineString;n.forEach(function(e){var t=e.split(",");a.pushLatLngAlt(t[0],t[1])});new H.map.Polyline(a,{style:{strokeColor:"blue",lineWidth:10}});for(var r=0;r<=e.length;r++){var l=new H.map.Marker({lat:e[i].lat,lng:e[i].long});o.push(l)}})})})}(t.latitude,t.longitude)};var c=function(e,n,a,r,l){for(var i in r){console.log(r[i].location);var t={searchText:r[i].location,jsonattributes:1};e.geocode(t,function(e){var t=e.response.view[0].result;console.log(t);var o="geo!"+t[0].location.displayPosition.latitude.toString()+","+t[0].location.displayPosition.longitude.toString();r[i].coordsStr=o,r[i].lat=location.displayPosition.latitude,r[i].long=location.displayPosition.longitude,console.log(r[i],o),console.log(t,r[i].coords),i+1==r.length&&l(r,n,a)},onError)}},u=function(e,t,o,n,a){var r=[],l=[],i="geo!"+t.toString()+","+o.toString();r.push(i);for(var s=0;s<=n.length;s++)if(null!=n[s]){r.push(n[s].coords),console.log(r);var c={mode:"fastest;car",waypoint0:r[s],waypoint1:r[s+1],representation:"display"};e.calculateRoute(c,function(e){console.log(e.response.route[0]),l.push(e.response.route[0])},function(e){alert(e.message)})}else a(n,l)}});