"use strict";function routingEach(e,t,o,n,a,i,r){e.calculateRoute(t,function(e){console.log(e.response.route[0]),o.push(e.response.route[0]),n[a]==n[a+1]&&(o.pop(),i(r,o))},function(e){alert(e.message)})}function geocodingEach(e,t,n,a,i,r,l){e.geocode(t,function(e){var t=e.response.view[0].result;console.log(t,n[a]);var o="geo!"+t[0].location.displayPosition.latitude.toString()+","+t[0].location.displayPosition.longitude.toString();n[a].coordsStr=o,n[a].lat=t[0].location.displayPosition.latitude,n[a].long=t[0].location.displayPosition.longitude,console.log(n[a],o),console.log(t,n[a].coordsStr),a+1==n.length&&i(n,r,l)},onError)}$(document).ready(function(){var e,t;e={},(t=app_fireBase).auth().onAuthStateChanged(function(e){e?(e.uid,o(),navigator.geolocation?($("#calendarInRoadmap").fullCalendar("changeView","agendaDay"),navigator.geolocation.getCurrentPosition(n)):alert("geolocation is not supported by this browser.")):window.location.replace("index.html")}),e.logOut=function(){t.auth().signOut()},$("#calendarInRoadmap").fullCalendar({header:{right:"prev,next today"},eventOverlap:!1,selectable:!0,selectHelper:!0,allDaySlot:!1,slotEventOverlap:!1,allDay:!0,editable:!0,eventLimit:!0,timezone:"America/Chicago",eventRender:function(e,t){var o=e.start.format().slice(11,16),n=e.end.format().slice(11,16);t.addClass(e.description),t.popover({title:e.title,content:"start time: "+o+", end time: "+n,trigger:"hover",placement:"top",container:"body"})},eventSources:["../scripts/events.js","../scripts/settings.js"]});var o=function(){var e=new Date,t=e.getFullYear(),o=e.getMonth()+1,n=e.getDate();$("#todaysDate").html("Today is "+n+"/"+o+"/"+t+"!")};var n=function(e){var t=e.coords;!function(l,s){var c=new H.service.Platform({app_id:"SKrth5W6mIRCcxVYfDWi",app_code:"bW5PezhhynKJWF85-sSZlA"});console.log(l,s);var d=c.createDefaultLayers(),g=new H.Map(document.getElementById("mapContainer"),d.normal.map,{zoom:10,center:{lat:l,lng:s}}),p=new H.mapevents.MapEvents(g);g.addEventListener("tap",function(e){console.log(e.type,e.currentPointer.type)});var e,t=firebase.auth().currentUser;null!=t&&(e=t.uid);firebase.database().ref("users/"+e+"/events/").once("value").then(function(e){var t=e.toJSON();console.log(t);var o=[],n=moment();for(var a in t)0<moment(t[a].end)-n&&(t[a].start=moment(t[a].start),t[a].end=moment(t[a].end),o.push(t[a]),console.log(t[a]));console.log(o),o.sort(function(e,t){return e.start.diff(t.start)}),console.log(o);var i=c.getGeocodingService(),r="geo!"+l.toString()+","+s.toString();[].push(r),u(i,l,s,o,function(e,t,o){console.log(e,t,o);var n=c.getRoutingService();v(n,t,o,e,function(e,t){console.log(e,t);new H.mapevents.Behavior(p);for(var o=H.ui.UI.createDefault(g,d),n=0;n<e.length;n++){var a=t[n].shape,i=new H.geo.LineString;a.forEach(function(e){var t=e.split(",");i.pushLatLngAlt(t[0],t[1])});var r=new H.map.Polyline(i,{style:{strokeColor:"blue",lineWidth:10}}),l=t[n].waypoint[0].mappedPosition,s=t[n].waypoint[1].mappedPosition,c=new H.map.Marker({lat:l.latitude,lng:l.longitude}),u=new H.map.Marker({lat:s.latitude,lng:s.longitude});g.addObjects([r,c,u]),o.addBubble(new H.ui.InfoBubble({lat:s.latitude,lng:s.longitude},{content:e[n].title+". "+e[n].location+". Time: "+e[n].start.format("HH:mm")})),g.setViewBounds(r.getBounds())}})})})}(t.latitude,t.longitude)};var u=function(e,t,o,n,a){for(var i=0;i<n.length;i++){console.log(n[i].location),geocodingEach(e,{searchText:n[i].location,jsonattributes:1},n,i,a,t,o)}},v=function(e,t,o,n,a){var i=[],r=[],l="geo!"+t.toString()+","+o.toString();i.push(l);for(var s=0;s<=n.length;s++){null!=n[s]?(i.push(n[s].coordsStr),console.log(i)):i.push(n[s-1].coordsStr),routingEach(e,{mode:"fastest;car",waypoint0:i[s],waypoint1:i[s+1],representation:"display"},r,i,s,a,n)}}});